<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lune Hosting | Pagamento</title>
    <link rel="stylesheet" href="style.css">
    <style>
        main {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 80vh;
            text-align: center;
        }

        .quase-la {
            color: white;
            font-weight: bold;
            font-size: 60px;
        }

        .desc {
            color: rgb(179, 179, 179);
            font-weight: bold;
            font-size: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
        }

        .modal-content {
            background-color: #0b0b0b;
            padding: 20px;
            margin: 10% auto;
            width: 300px;
            border-radius: 8px;
            text-align: center;
        }

        .modal input {
            width: 90%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .modal button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            width: 100%;
            border-radius: 5px;
        }
    </style>
</head>
<body>

<header>
    <h1>
        <img src="https://i.imgur.com/feIQmi4.png" alt="Logo Lune" style="width: 70px; height: auto; vertical-align: middle; margin-right: 10px;">
        Lune Hosting
    </h1>
    <div class="header-buttons">
        <a href="index.html"><button>Retornar</button></a>
    </div>
</header>

<main>
    <h2 id="plan-name"></h2>
    <p class="quase-la">Quase lá!</p>
    <p class="desc">Agora você pode pagar com um Cartão de Crédito ou realizar um pagamento via Pix:</p>

    <div id="paypal-button-container"></div>

    <!-- Botão de teste grátis -->
    <button id="test-free" style="background: #007bff; color: white; border: none; padding: 10px; cursor: pointer; width: 100%; border-radius: 5px; margin-top: 20px;">
        Obter de Graça (Testar)
    </button>

</main>

<div id="userModal" class="modal">
    <div class="modal-content">
        <h3>Criação da Conta</h3>
        <input type="email" id="email" placeholder="Seu e-mail" required>
        <input type="password" id="senha" placeholder="Crie uma senha" required>
        <button onclick="criarConta()">Criar Conta</button>
    </div>
</div>

<footer class="site-footer">
    <div class="footer-bottom">
        <p>Lune Hosting © 2025 - Todos os direitos reservados.</p>
    </div>
</footer>

<script src="https://www.paypal.com/sdk/js?client-id=ASNolNlpVykBfRlKLeUj45P-G16GMfZSyX5j3pwa00S8YZmjL9yuBFBco6_Hs9NAx7kLS-m8ujJYuYgK&currency=BRL"></script>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const planName = urlParams.get('plano') ? decodeURIComponent(urlParams.get('plano')) : "Plano Desconhecido";
    const planPrice = urlParams.get('preco') ? parseFloat(urlParams.get('preco')) : 0;

    console.log("Plan Name:", planName);
    console.log("Plan Price:", planPrice);

    if (!planPrice || planPrice <= 0) {
        alert("Erro: preço inválido.");
    } else {
        paypal.Buttons({
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: { value: planPrice.toFixed(2) },
                        description: `Plano: ${planName}`
                    }]
                });
            },
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {
                    alert('Pagamento concluído! Obrigado, ' + details.payer.name.given_name);
                    document.getElementById('userModal').style.display = 'block';
                });
            },
            onCancel: function(data) {
                alert('Pagamento cancelado.');
            },
            onError: function(err) {
                console.error("Erro no PayPal:", err);
                alert('Ocorreu um erro ao processar o pagamento.');
            }
        }).render('#paypal-button-container');
    }

    document.getElementById('test-free').addEventListener('click', function() {
        document.getElementById('userModal').style.display = 'block';
    });

    function criarConta() {
        const email = document.getElementById('email').value;
        const senha = document.getElementById('senha').value;

        if (!email || !senha) {
            alert("Preencha todos os campos!");
            return;
        }

        fetch('https://panel.lunehosting.shop/api/application/users', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ptla_Ny3s2w7A0bS4U4DBMetcL0hvHwApvKVhyVs0vjylXAa',
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({
                username: email.split('@')[0],
                email: email,
                first_name: email.split('@')[0],
                last_name: "LuneUser",
                password: senha
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.object === 'user') {
                createServer(data.attributes.id);
            } else {
                alert("Erro ao criar conta no Pterodactyl!");
            }
        })
        .catch(error => console.error('Erro:', error));
    }

    async function createServer(userId) {
        const response = await fetch("https://panel.lunehosting.shop/api/application/servers", {
            method: "POST",
            headers: {
                "Authorization": "Bearer ptla_Ny3s2w7A0bS4U4DBMetcL0hvHwApvKVhyVs0vjylXAa",
                "Content-Type": "application/json",
                "Accept": "application/json"
            },
            body: JSON.stringify({
                name: `Servidor de ${userId}`,
                user: userId,
                egg: 1,
                docker_image: "ghcr.io/pterodactyl/yolks:java_21",
                startup: "java -Xms128M -XX:MaxRAMPercentage=95.0 -jar {{SERVER_JARFILE}}",
                limits: { memory: 1024, cpu: 100, disk: 5000 },
                feature_limits: { databases: 1, backups: 1 },
            })
        });

        const data = await response.json();
        console.log("Servidor criado:", data);
    }
</script>

</body>
</html>